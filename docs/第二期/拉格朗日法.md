# 拉格朗日法
## 1. 带约束优化问题
在实际应用中，我们经常面对的优化问题涉及到一定的约束条件。例如，背包问题要求在不超过背包容量的限制下，使得装入背包的物品价值最大化。这些约束可以是等式约束，也可以是不等式约束，可以通过如下形式的数学表达来表示：


$$
\begin{aligned}
    \min \quad & f(x)\\
    \text{s.t.} \quad & g_i(x) = 0; \quad i=1, \dots, n\\
    & h_j(x) \leq 0; \quad j=1, \dots, m
\end{aligned}
$$

其中，$f(x)$ 是目标函数，$g_i(x)$ 是等式约束条件，$h_j(x)$ 是不等式约束条件。为了解决这种带约束优化的问题，可以采用罚函数、内点法、启发式算法等，但这些算法相对复杂。因此，本文介绍一种常见且易于理解的方法——拉格朗日乘子法。

## 2. 拉格朗日乘子法
通过引入拉格朗日乘子构建拉格朗日函数，拉格朗日乘子法巧妙地将带约束的优化问题转化为无约束的优化问题，进而求解。

### 2.1 基本步骤：

1. **建立拉格朗日函数**：
   假设有一个带有约束条件的优化问题：
   $$
   \begin{aligned}
    \min \quad & f(x) \\
    \text{s.t.} \quad & g_i(x) = 0; \quad  i = 1, 2, \ldots, m\\
   \end{aligned}
   $$

   其中，\( f(x) \) 是目标函数，\( g_i(x) \) 是约束条件。首先，引入拉格朗日乘子 \( \lambda_i \) ，定义拉格朗日函数：
   \[
   L(x, \lambda) = f(x) + \sum_{i=1}^{m} \lambda_i g_i(x)
   \]

2. **求解拉格朗日函数的梯度**：
   对拉格朗日函数 \( L(x, \lambda) \) 关于变量 \( x \) 和拉格朗日乘子 \( \lambda \) 求偏导数，并令其为零，得到方程组：
   \[
   \frac{\partial L}{\partial x} = 0, \\
   \quad \frac{\partial L}{\partial \lambda_i} = 0, \quad i = 1, 2, \ldots, m
   \]
   解这个方程组，即可得到最优解 \( x^* \) 和拉格朗日乘子 \( \lambda^* \)。

3. **求解原始问题的最优解**：
   将得到的最优解 \( x^* \) 代入原始问题的目标函数中，即可得到原始问题的最优解。

### 2.2 示例
下面举一个简单的例子来说明拉格朗日法的应用：

假设有一个优化问题：
$$
\begin{aligned}
\min_{x} &\quad x^2 \quad \\
\text{s.t.} &\quad x-2 = 0
\end{aligned}
$$
其中，目标函数 \( f(x) = x^2 \)，约束条件 \( g(x) = x - 2 = 0 \)。

首先，构建拉格朗日函数：
\[
L(x, \lambda) = f(x) + \lambda g(x) = x^2 + \lambda (x - 2)
\]

然后，求解拉格朗日函数的梯度，并令其为零：
$$
\begin{aligned}
\frac{\partial L}{\partial x} &= 2x + \lambda = 0, \\
\frac{\partial L}{\partial \lambda} &= x - 2 = 0
\end{aligned}
$$

解这个方程组，可以得到最优解 \( x^* = 2 \) 和拉格朗日乘子 \( \lambda^* = -4 \)。

最后，将最优解 \( x^* = 2 \) 代入原始问题的目标函数中，得到原始问题的最优解为 \( f(x^*) = 2^2 = 4 \)。

### 2.3 理解
拉格朗日乘子法到底在做什么？我们先来看下图：

![](./images/拉格朗日理解.png)

图中的椭圆虚线为目标函数$f(x,y)$ 的等高线，红色实线为约束条件$g(x,y)=c$。我们可以发现，当约束曲线$g(x,y)=c$和等高线$f(x,y)=d_1$相切时，目标函数$f(x,y)$取得极值。两条曲线相切，意味着他们在这点的法线平行，只差一个常数倍（设为$-\lambda$）。

联立方程：

$$
\begin{aligned}
    \nabla f(x,y) &= -\lambda \nabla g \\
    g(x, y) &= c \\
\end{aligned}
$$

代入$2.2$例子，即为：
$$
\begin{aligned}
    2x = -\lambda \\
    x = 2 \\
\end{aligned}
$$
求解可知$x^* = 2$。

因此，拉格朗日法其实就是在找目标函数与约束条件相切的那个极值点，同时也是拉格朗日函数的驻点、原始优化问题的解。

### 2.4 优缺点
拉格朗日法将带约束优化问题转换为一个不带约束的问题，从而简化了问题的求解，且适用于各种类型的约束条件，包括等式约束和不等式约束。

然而，拉格朗日法得到的解也可能陷入局部最优，而不是全局最优；且随着约束条件的数量增加，拉格朗日函数的导数方程组可能会变得非常复杂，导致计算量增加。

## 3. 增广拉格朗日法

其本质就是在拉格朗日法的基础上加了一个惩罚项。


## 4. 参考资料
[1] [【知乎】如何理解拉格朗日乘子法？](https://www.zhihu.com/question/38586401) <br>

